[规范文档](https://spec.commonmark.org/0.30/)

## 字符和行

- 行是除换行符(U+000A)或回车符(U+000D)以外的零个或多个字符的序列，后跟行结束符或文件结束符。
- 行结束是换行(U+000A)、回车(U+000D)后不换行，或者回车后再换行。
- 不包含字符的行，或只包含空格(U+0020)或制表符(U+0009)的行称为空行。
- Unicode空白字符是Unicode Zs通用类别中的任何代码点，或者制表符(U+0009)、换行符(U+000A)、换行符(U+000C)或回车符(U+000D)。

- 制表符是 U+0009
- 空格字符是 U+0020
- ASCII控制字符是介于U+00000–1F（两者均包含）或U+007F之间的字符。
- ASCII标点字符是！，“，#，$，%，&，'，（，），*，+，，-，.，/（U+0021–2F），：，；，<，=，>，？，@（U+003A–0040），[，\，]，^，_，`（U+005B–0060），{，|，}，或~（U+007B–007E）。
- Unicode标点字符是ASCII标点字符或通用Unicode类别Pc、Pd、Pe、Pf、Pi、Po或Ps中的任何字符。

## tab制表符

行内容开始字符是制表符或4个空格，该行作为代码块

## 转义

- 标点符号转义
```
\!\"\#\$\%\&\'\(\)\*\+\,\-\.\/\:\;\<\=\>\?\@\[\\\]\^\_\`\{\|\}\~

!&quot;#$%&amp;'()*+,-./:;&lt;=&gt;?@[\]^_`{|}~
```
- 行尾的反斜杠是硬换行符

## 块内容和内联内容

文档由一系列块结构元素构成，如段落、块引用、列表、标题、规则和代码块。一些块（如块引号和列表项）包含其他块；其他（如标题和段落）包含内联内容文本、链接、强调文本、图像、代码跨度等

- 优先级：块结构总是优于内联结构。

对于markdown文档解析可以分两个步骤进行:首先，可以识别文档的块结构;其次，段落、标题和其他块结构中的文本行可以被解析为内联结构。第二步需要关于链接引用定义的信息，这些信息只有在第一步结束时才可用。注意，第一步需要按顺序处理行，但第二步可以并行处理，因为一个块元素的内联解析不会影响其他任何块元素的内联解析

## 容器块和叶子块

块内容可分为容器块和叶子块，前者可包含其他块内容，后者不能包含块内容。

### 叶子块
#### 主题分割符

一行可选地包含最多三个缩进空格，后面跟着三个或多个匹配的-、_、或*字符序列，每个字符后面可选地跟着任意数量的空格或制表符，形成一个主题分隔符（该行要求除空格外，所有字符都一样, 前后不需要换行）

```
***
---
___
```

特殊情况：
- 如果前后行都有文本，且满足主题分隔符，且使用`-`字符作为分隔符，则其前一行被当成标题行，后一行为段落行
```
title
---
content
```

- 当主题分割和列表项都可能是行结构的情况时，主题分割行优先
```
* Foo
* * *
* Bar
```
可以考虑使用不同的项目符号，避免混淆。

#### 缩进代码块

缩进的代码块由一个或多个由空行分隔的缩进块组成。缩进块是一系列非空行，每行前面有四个或更多的缩进空格。代码块的内容是行的文字内容，包括尾行结尾，减去四个缩进空格。缩进的代码块没有信息字符串。

缩进代码块不能中断段落，因此段落和后面的缩进代码块之间必须有一行空白。（但是，代码块和下一段之间不需要空行。）

#### 代码块

代码块是至少三个连续反引号(`)或波浪号(~)组成的序列。(波浪号和反引号不能混合使用。)分隔代码块以代码分隔开始，前面有最多三个空格的缩进。

代码块的内容由所有后续行组成，直到出现与代码块开头相同类型的结束代码栏(反勾号或波浪号)，并且至少具有与开始代码栏相同数量的反勾号或波浪号。如果前导代码栏前面有N个空格的缩进，则从内容的每一行中删除最多N个空格的缩进(如果存在的话)。(如果内容行没有缩进，则保持不变。如果缩进N位或更少，则删除所有的缩进。)

一个封闭的代码块可以中断一个段落，并且前后都不需要空行。

代码围栏的内容被视为文本，而不是作为内联进行解析。信息字符串的第一个单词通常用于指定代码样本的语言，并在代码标记的class属性中呈现。然而，此规范不要求对信息字符串进行任何特殊处理。

#### HTML块

#### 链接引用定义块

链接引用定义由一个链接标签组成，链接标签前面可以有最多三个缩进空格，后面可以有冒号（:）、可选空格或制表符（包括最多一行结尾）、链接目标、可选空格和制表符（最多一行结束），以及可选链接标题，如果存在，则必须用空格或制表键将链接标题与链接目标隔开。不能再出现其他字符。

链接引用定义与文档的结构元素不对应。相反，它定义了一个标签，可以在文档中其他地方的引用链接和引用样式图像中使用。链接引用定义可以在使用它们的链接之前或之后。

- 链接地址不能被省略，可以使用尖括号指定空链
```md
[foo]: <>

[foo]
```

- 标题是可选的，可以有多行，但不包含空行
```md
[foo]: /url '
title
line1
line2
'

[foo]
```

- 标题必须用空格或制表符与链接地址分开
```md
[foo]: /url "title"

[foo]
```

- 标题后不能有出空格或制表符外的其他任何字符
- 如果有多个相同的链接定义，则第一个优先
- 链接的匹配不区分大小写
- 链接可以只定义，不使用，链接定义不会再页面结构显示
- 链接定义块不能中断段落
- 链接引用定义可以发生在块容器中，比如列表和块引用。它们影响整个文档，而不仅仅是定义它们的容器

#### ATX标题块

介于1–6个未转义#字符的开头序列和任意数量的未转义#字符串的可选结尾序列之间。#字符的开头序列必须后跟空格或制表符，或行尾。可选的结束序列#前面必须有空格或制表符，后面只能有空格或选项卡。开头的#字符前面最多可以有三个空格的缩进。标题的原始内容在被解析为内联内容之前被去除了前导和尾随空格或制表符。标题级别等于开头序列中的#字符数。解析的内容为内联内容。

标题块内容不需要空行与前后内容隔开。

#### Setext标题块

setext标题由一行或多行文本组成，不被空行打断，其中第一行的缩进空间不超过3个，后跟setext标题下划线。文本行必须是这样的，如果它们后面没有setext标题下划线，它们将被解释为一个段落：它们不能被解释为代码栏、ATX标题、块引用、主题分隔符、列表项或HTML块。

setext标题下划线是一个=字符序列或一个-字符序列，不超过3个缩进空格和任意数量的尾随空格或制表符。如果包含单个-的行可以被解释为空列表项，则应该这样解释，而不是将其解释为setext标题下划线。

如果在setext标题下划线中使用=字符，则标题为1级标题，如果使用-字符，则为2级标题。标题的内容是将前面的文本行解析为CommonMark内联内容的结果。

通常，setext标题不需要在其前面或后面加上空白行。然而，它不能中断段落，因此当段落后面出现setext标题时，它们之间需要空行。

#### 段落

不能解释为其他类型块的一系列非空白行构成段落。段落的内容是将段落的原始内容解析为内联的结果。段落的原始内容是通过连接行并删除开头和结尾空格或制表符而形成的。

### 内容块

容器块是包含其他块作为其内容的块。容器块有两种基本类型：引用块和列表项。列表是列表项的元容器。

## 内联内容

内联从字符流的开始到结束依次解析